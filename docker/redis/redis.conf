# Redis Configuration for MCP Codebase Analyzer

# 네트워크 설정
bind 0.0.0.0
protected-mode no
port 6379

# 일반 설정
daemonize no
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile ""

# 데이터베이스 설정
databases 16

# 스냅샷 설정 (RDB)
save 900 1      # 900초(15분) 동안 1개 이상의 키가 변경되면 저장
save 300 10     # 300초(5분) 동안 10개 이상의 키가 변경되면 저장
save 60 10000   # 60초 동안 10000개 이상의 키가 변경되면 저장

stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# AOF(Append Only File) 설정
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# 메모리 관리
maxmemory 2gb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# 슬로우 로그
slowlog-log-slower-than 10000
slowlog-max-len 128

# 클라이언트 설정
tcp-keepalive 300
tcp-backlog 511
timeout 0

# 클러스터 설정 (단일 노드이므로 비활성화)
# cluster-enabled no

# 키 이벤트 알림 (선택사항)
notify-keyspace-events "Ex"

# 캐시 최적화
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no

# 보안 설정 (docker-compose.yml에서 설정)
# requirepass는 docker-compose 환경변수로 설정됨