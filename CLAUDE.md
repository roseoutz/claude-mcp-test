# CLAUDE.md

μ΄ νμΌμ€ Claude Code (claude.ai/code)κ°€ μ΄ μ €μ¥μ†μ—μ„ μ‘μ—…ν•  λ• μ°Έκ³ ν•λ” κ°€μ΄λ“μ…λ‹λ‹¤.

## π“ κΈ°λ³Έ μ„¤μ •

- **λ¨λ“  λ€ν™”μ—λ” [λ‹µλ³€] λΌλ” ν‚¤μ›λ“λ¥Ό λ¶™μ—¬μ¤**

## π€ λ…λ Ήμ–΄ κ°€μ΄λ“

### λ¨λ…Έλ ν¬ κ΄€λ¦¬
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `npm install` | λ¨λ“  μ›ν¬μ¤νμ΄μ¤ μμ΅΄μ„± μ„¤μΉ |
| `npm run build` | λ¨λ“  ν¨ν‚¤μ§€ λΉλ“ |
| `npm run clean` | λ¨λ“  λΉλ“ κ²°κ³Όλ¬Ό μ‚­μ  |

### λ΅μ»¬ MCP μ„λ²„ (NestJS v11)
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `npm run dev:local` | NestJS μ„λ²„ κ°λ° λ¨λ“ μ‹¤ν–‰ (ν•« λ¦¬λ΅λ“) |
| `npm run build -w @code-ai/local-mcp` | λ΅μ»¬ MCP ν¨ν‚¤μ§€ λΉλ“ |
| `npm test -w @code-ai/local-mcp` | λ΅μ»¬ MCP ν¨ν‚¤μ§€ ν…μ¤νΈ |

### AWS API μ„λ²„
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `npm run dev:aws` | HTTPμ™€ gRPC μ„λ²„ λ™μ‹ μ‹¤ν–‰ |
| `npm run build -w @code-ai/aws-api` | AWS API ν¨ν‚¤μ§€ λΉλ“ |
| `cd packages/aws-api && npm run deploy` | AWS CDKλ¥Ό μ‚¬μ©ν• λ°°ν¬ |

### Docker μΈν”„λΌ
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `docker-compose up -d` | λ¨λ“  μΈν”„λΌ μ„λΉ„μ¤ μ‹μ‘ |
| `docker-compose down` | λ¨λ“  μΈν”„λΌ μ„λΉ„μ¤ μ¤‘μ§€ |
| `docker-compose --profile dev up -d` | κ°λ° λ„κµ¬ ν¬ν•¨ μ‹¤ν–‰ |

## π— μ•„ν‚¤ν…μ²

### ν¨ν‚¤μ§€ κµ¬μ΅°

#### π“¦ `packages/local-mcp` - λ΅μ»¬ MCP μ„λ²„
- **ν”„λ μ„μ›ν¬**: NestJS v11
- **μ£Όμ” λ¨λ“**:
  - `src/app.module.ts`: μ• ν”λ¦¬μΌ€μ΄μ… λ£¨νΈ λ¨λ“
  - `src/mcp/mcp.service.ts`: MCP ν”„λ΅ν† μ½ ν•Έλ“¤λ¬ κµ¬ν„
  - `src/grpc/grpc-client.service.ts`: AWS μ„λ²„μ™€μ gRPC ν†µμ‹ 
  - `src/analysis/`: μ¤νΈλ¦¬λ° μ‘λ‹µ λ° μ±„ν… μ„Έμ… μ²λ¦¬

#### π“¦ `packages/aws-api` - AWS API μ„λ²„
- **λ°νƒ€μ„**: Node.js + Express + gRPC
- **μ£Όμ” κµ¬μ„±μ”μ†**:
  - `src/grpc/grpc.server.ts`: λ¨λ“  RPC λ©”μ„λ“ κµ¬ν„
  - `src/index.ts`: Express μ„λ²„ μ§„μ…μ 
  - **ν¬νΈ**: HTTP (3000), gRPC (50051)
  - **AI ν†µν•©**: OpenAI API (μ‹λ§¨ν‹± κ²€μƒ‰, μ±„ν…)

#### π“¦ `packages/shared` - κ³µμ  νƒ€μ… λ° ν”„λ΅ν† μ½
- **ν”„λ΅ν† μ½ μ •μ**: `proto/analysis.proto` - gRPC μ„λΉ„μ¤ μ •μ
- **νƒ€μ… μ‹μ¤ν…**: 
  - `src/types/`: TypeScript νƒ€μ… μ •μ
  - Zod μ¤ν‚¤λ§λ¥Ό ν†µν• λ°νƒ€μ„ κ²€μ¦
- **μ ν‹Έλ¦¬ν‹°**: `src/utils/` - κ³µν†µ ν—¬νΌ ν•¨μ

### ν†µμ‹  ν¨ν„΄

#### gRPC λ©”μ„λ“ νƒ€μ…

| ν¨ν„΄ | λ©”μ„λ“ | μ„¤λ… |
|------|--------|------|
| **Unary RPC** | `learnCodebase` | λ‹¨μ μ”μ²­/μ‘λ‹µ |
| **Server Streaming** | `analyzeCodebase` | λ¶„μ„ μ§„ν–‰ μƒν™© μ¤νΈλ¦¬λ° |
| | `searchCode` | κ²€μƒ‰ κ²°κ³Ό μ¤νΈλ¦¬λ° |
| | `analyzeDiff` | Diff λ¶„μ„ κ²°κ³Ό μ¤νΈλ¦¬λ° |
| **Bidirectional Streaming** | `chatWithCode` | λ€ν™”ν• μ±„ν… |

### ν•µμ‹¬ κΈ°μ  κ²°μ •

| κΈ°μ  | μ„ νƒ μ΄μ  |
|------|-----------|
| **NestJS v11** | μµμ‹  κΈ°λ¥κ³Ό μ„±λ¥ μµμ ν™” |
| **gRPC + HTTP/2** | ν¨μ¨μ μΈ λ°”μ΄λ„λ¦¬ ν”„λ΅ν† μ½κ³Ό μ¤νΈλ¦¬λ° μ§€μ› |
| **Protocol Buffers** | νƒ€μ… μ•μ „ν• μ„λΉ„μ¤ μ •μ |
| **RxJS Observables** | NestJSμ—μ„μ μ¤νΈλ¦Ό μ²λ¦¬ |
| **SSE** | μ›Ή ν΄λΌμ΄μ–ΈνΈ μ¤νΈλ¦¬λ° μ§€μ› |
| **npm workspaces** | μμ΅΄μ„± κ³µμ  λ° ν†µν•© λΉλ“ κ΄€λ¦¬ |

## β™οΈ ν™κ²½ μ„¤μ •

### ν•„μ ν™κ²½ λ³€μ

| λ³€μλ… | μ„¤λ… | κΈ°λ³Έκ°’ |
|--------|------|--------|
| `OPENAI_API_KEY` | OpenAI API ν‚¤ | - |
| `GRPC_SERVER_URL` | gRPC μ„λ²„ μ£Όμ† | `localhost:50051` |
| `PORT` | HTTP μ„λ²„ ν¬νΈ | local: 3001, aws: 3000 |
| `GRPC_PORT` | gRPC μ„λ²„ ν¬νΈ | 50051 |

### Docker μΈν”„λΌ μ„λΉ„μ¤

| μ„λΉ„μ¤ | μ©λ„ | ν¬νΈ |
|--------|------|------|
| **ChromaDB** | λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤ (μ„λ² λ”©) | 8000 |
| **Redis** | μΊμ‹± λ μ΄μ–΄ | 6379 |
| **PostgreSQL** | λ©”νƒ€λ°μ΄ν„° μ €μ¥μ† | 5432 |
| **MinIO** | S3 νΈν™ κ°μ²΄ μ €μ¥μ† | 9000 (API), 9001 (Console) |
| **Nginx** | λ¦¬λ²„μ¤ ν”„λ΅μ‹ | 80, 443 |
| **pgAdmin** | PostgreSQL κ΄€λ¦¬ UI (dev ν”„λ΅νμΌ) | 5050 |
| **Redis Commander** | Redis κ΄€λ¦¬ UI (dev ν”„λ΅νμΌ) | 8081 |

## π”§ κ°λ° κ°€μ΄λ“

### μƒλ΅μ΄ MCP λ„κµ¬ μ¶”κ°€ μ μ°¨

1. **ν”„λ΅ν† μ½ μ •μ**: `packages/shared/proto/analysis.proto`μ— gRPC μ„λΉ„μ¤ μ •μ
2. **μ„λ²„ κµ¬ν„**: `packages/aws-api/src/grpc/grpc.server.ts`μ— ν•Έλ“¤λ¬ κµ¬ν„
3. **ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€**: `packages/local-mcp/src/grpc/grpc-client.service.ts`μ— λ©”μ„λ“ μ¶”κ°€
4. **MCP λ“±λ΅**: `packages/local-mcp/src/mcp/mcp.service.ts`μ— λ„κµ¬ λ“±λ΅

### λ¨λ²” μ‚¬λ΅€

#### μ„±λ¥ μµμ ν™”
- λ€μ©λ‰ λ°μ΄ν„°λ‚ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈλ” μ¤νΈλ¦¬λ° μ‚¬μ©
- μΊμ‹± μ „λµ μ κ·Ή ν™μ©
- λ°°μΉ μ²λ¦¬λ΅ λ„¤νΈμ›ν¬ νΈμ¶ μµμ†ν™”

#### μ½”λ“ ν’μ§
- gRPC μ¤νΈλ¦Όμ—μ„ μ μ ν• μ—λ¬ μ²λ¦¬ κµ¬ν„
- NestJS λ¨λ“ κµ¬μ΅°μ™€ μμ΅΄μ„± μ£Όμ… ν¨ν„΄ μ¤€μ
- Protocol Buffersμ™€ Zod μ¤ν‚¤λ§λ΅ νƒ€μ… μ•μ „μ„± λ³΄μ¥

#### μ΄μ κ΄€λ¦¬
- ν¨ν‚¤μ§€λ³„ μ‘μ—…μ‹ npm workspaces λ…λ Ήμ–΄ μ‚¬μ©
- ν™κ²½λ³„ μ„¤μ • λ¶„λ¦¬ (development, production, test)
- λ΅κΉ… λ λ²¨ μ μ ν μ„¤μ •

### λ””λ²„κΉ… ν

| λ¬Έμ  μƒν™© | ν•΄κ²° λ°©λ²• |
|-----------|-----------|
| gRPC μ—°κ²° μ‹¤ν¨ | `GRPC_SERVER_URL` ν™κ²½ λ³€μ ν™•μΈ |
| νƒ€μ… μ—λ¬ | `npm run build -w @code-ai/shared` λ¨Όμ € μ‹¤ν–‰ |
| Docker μ„λΉ„μ¤ λ¬Έμ  | `docker-compose logs [μ„λΉ„μ¤λ…]` ν™•μΈ |
| ν…μ¤νΈ μ‹¤ν¨ | `npm test -w [ν¨ν‚¤μ§€λ…]`μΌλ΅ κ°λ³„ ν…μ¤νΈ |

## π“ μ‘μ—… νλ¦„

### κΈ°λ¥ κ°λ° ν”„λ΅μ„Έμ¤
1. νƒ€μ… μ •μ (`packages/shared/src/types/`)
2. Proto νμΌ μ—…λ°μ΄νΈ (ν•„μ”μ‹)
3. μ„λ²„ λ΅μ§ κµ¬ν„
4. ν΄λΌμ΄μ–ΈνΈ ν†µν•©
5. ν…μ¤νΈ μ‘μ„±
6. λ¬Έμ„ μ—…λ°μ΄νΈ

### μ»¤λ°‹ κ·μΉ™
- `feat:` μƒλ΅μ΄ κΈ°λ¥
- `fix:` λ²„κ·Έ μμ •
- `refactor:` μ½”λ“ λ¦¬ν©ν† λ§
- `docs:` λ¬Έμ„ μ—…λ°μ΄νΈ
- `test:` ν…μ¤νΈ μ¶”κ°€/μμ •
- `chore:` λΉλ“/μ„¤μ • λ³€κ²½

## π” μ£Όμ” νμΌ μ„μΉ

```
ν”„λ΅μ νΈ λ£¨νΈ/
β”β”€β”€ packages/
β”‚   β”β”€β”€ local-mcp/        # λ΅μ»¬ MCP μ„λ²„
β”‚   β”β”€β”€ aws-api/          # AWS API μ„λ²„
β”‚   β””β”€β”€ shared/           # κ³µμ  μ½”λ“
β”β”€β”€ docker/               # Docker μ„¤μ •
β”β”€β”€ .env.example         # ν™κ²½ λ³€μ ν…ν”λ¦Ώ
β””β”€β”€ docker-compose.yml   # Docker Compose μ„¤μ •
```