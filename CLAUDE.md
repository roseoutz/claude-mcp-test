# CLAUDE.md

μ΄ νμΌμ€ Claude Code (claude.ai/code)κ°€ μ΄ μ €μ¥μ†μ—μ„ μ‘μ—…ν•  λ• μ°Έκ³ ν•λ” κ°€μ΄λ“μ…λ‹λ‹¤.

## π“ κΈ°λ³Έ μ„¤μ •

- **λ¨λ“  λ€ν™”μ—λ” [λ‹µλ³€] λΌλ” ν‚¤μ›λ“λ¥Ό λ¶™μ—¬μ¤**

## π’» κΈ°μ  μ¤νƒ

### ν•µμ‹¬ ν”„λ μ„μ›ν¬ λ° λ°νƒ€μ„
| μΉ΄ν…κ³ λ¦¬ | κΈ°μ  | λ²„μ „ | μ©λ„ |
|----------|------|------|------|
| **Runtime** | Node.js | β‰¥22.0.0 | JavaScript λ°νƒ€μ„ |
| **Language** | TypeScript | 5.3.3 | νƒ€μ… μ•μ „μ„± |
| **Backend Framework** | NestJS | v11 | λ΅μ»¬ MCP μ„λ²„ |
| **Web Framework** | Express | 4.x | AWS API HTTP μ„λ²„ |
| **Package Manager** | npm workspaces | 10.x | λ¨λ…Έλ ν¬ κ΄€λ¦¬ |

### ν†µμ‹  λ° ν”„λ΅ν† μ½
| κΈ°μ  | μ©λ„ | νΉμ§• |
|------|------|------|
| **gRPC** | μ„λ²„ κ°„ ν†µμ‹  | HTTP/2 κΈ°λ°, μ¤νΈλ¦¬λ° μ§€μ› |
| **Protocol Buffers** | μ„λΉ„μ¤ μ •μ | νƒ€μ… μ•μ „ν• RPC |
| **MCP SDK** | Model Context Protocol | Claudeμ™€μ ν†µμ‹  |
| **SSE** | Server-Sent Events | μ›Ή ν΄λΌμ΄μ–ΈνΈ μ¤νΈλ¦¬λ° |
| **WebSocket** | μ‹¤μ‹κ°„ μ–‘λ°©ν–¥ ν†µμ‹  | μ±„ν… κΈ°λ¥ (μ„ νƒμ ) |

### λ°μ΄ν„° μ €μ¥ λ° μΊμ‹±
| κΈ°μ  | μ©λ„ | ν¬νΈ |
|------|------|------|
| **PostgreSQL** | λ©”νƒ€λ°μ΄ν„° μ €μ¥ | 5432 |
| **Redis** | μΊμ‹± λ° μ„Έμ… | 6379 |
| **ChromaDB** | λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤ | 8000 |
| **MinIO** | S3 νΈν™ κ°μ²΄ μ €μ¥ | 9000/9001 |

### AI λ° λ¨Έμ‹ λ¬λ‹
| μ„λΉ„μ¤ | μ©λ„ | λ¨λΈ |
|--------|------|------|
| **OpenAI API** | μ½”λ“ λ¶„μ„, μ„λ² λ”© | GPT-4, text-embedding-3 |
| **Anthropic API** | μ½”λ“ μƒμ„± (μ„ νƒμ ) | Claude 3 |
| **Vector Embeddings** | μ‹λ§¨ν‹± κ²€μƒ‰ | 1536 μ°¨μ› |

### κ°λ° λ„κµ¬
| λ„κµ¬ | μ©λ„ | μ„¤μ • νμΌ |
|------|------|-----------|
| **Vitest** | λ‹¨μ„ ν…μ¤νΈ | vitest.config.ts |
| **ESLint** | μ½”λ“ λ¦°ν… | .eslintrc.json |
| **Prettier** | μ½”λ“ ν¬λ§¤ν… | .prettierrc |
| **TSX** | TypeScript μ‹¤ν–‰ | - |
| **Docker Compose** | μΈν”„λΌ κ΄€λ¦¬ | docker-compose.yml |

### μ£Όμ” λΌμ΄λΈλ¬λ¦¬
| ν¨ν‚¤μ§€ | μ©λ„ | μ„μΉ |
|--------|------|------|
| **simple-git** | Git μ‘μ—… | local-mcp |
| **glob** | νμΌ ν¨ν„΄ λ§¤μΉ­ | local-mcp |
| **zod** | λ°νƒ€μ„ νƒ€μ… κ²€μ¦ | shared |
| **rxjs** | λ¦¬μ•΅ν‹°λΈ ν”„λ΅κ·Έλλ° | local-mcp |
| **@grpc/grpc-js** | gRPC ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ | μ „μ²΄ |

## π— μ‹μ¤ν… μ•„ν‚¤ν…μ²

### λ μ΄μ–΄λ“ μ•„ν‚¤ν…μ²
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚         Presentation Layer              β”‚
β”‚     (MCP Protocol, REST API, gRPC)      β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚         Application Layer               β”‚
β”‚    (NestJS Services, Controllers)       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚          Domain Layer                   β”‚
β”‚    (Business Logic, Domain Types)       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚       Infrastructure Layer              β”‚
β”‚  (Database, Cache, External Services)   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### ν¨ν‚¤μ§€ μμ΅΄μ„± κµ¬μ΅°
```
packages/shared (κ³µν†µ νƒ€μ…, μ ν‹Έλ¦¬ν‹°)
    β†‘
    β”β”€β”€ packages/local-mcp (λ΅μ»¬ MCP μ„λ²„)
    β”‚       β†“ gRPC Client
    β””β”€β”€ packages/aws-api (AWS API μ„λ²„)
            β†“ gRPC Server
```

### λ°μ΄ν„° νλ¦„
```
Claude Desktop β†’ MCP Protocol β†’ Local MCP Server
                                      β†“
                                  gRPC + HTTP/2
                                      β†“
                              AWS API Server
                                      β†“
                        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                        β†“             β†“             β†“
                    OpenAI API   ChromaDB    PostgreSQL
```

## π€ λ…λ Ήμ–΄ κ°€μ΄λ“

### λ¨λ…Έλ ν¬ κ΄€λ¦¬
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `npm install` | λ¨λ“  μ›ν¬μ¤νμ΄μ¤ μμ΅΄μ„± μ„¤μΉ |
| `npm run build` | λ¨λ“  ν¨ν‚¤μ§€ λΉλ“ |
| `npm run clean` | λ¨λ“  λΉλ“ κ²°κ³Όλ¬Ό μ‚­μ  |

### λ΅μ»¬ MCP μ„λ²„ (NestJS v11)
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `npm run dev:local` | NestJS μ„λ²„ κ°λ° λ¨λ“ μ‹¤ν–‰ (ν•« λ¦¬λ΅λ“) |
| `npm run build -w @code-ai/local-mcp` | λ΅μ»¬ MCP ν¨ν‚¤μ§€ λΉλ“ |
| `npm test -w @code-ai/local-mcp` | λ΅μ»¬ MCP ν¨ν‚¤μ§€ ν…μ¤νΈ |

### AWS API μ„λ²„
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `npm run dev:aws` | HTTPμ™€ gRPC μ„λ²„ λ™μ‹ μ‹¤ν–‰ |
| `npm run build -w @code-ai/aws-api` | AWS API ν¨ν‚¤μ§€ λΉλ“ |
| `cd packages/aws-api && npm run deploy` | AWS CDKλ¥Ό μ‚¬μ©ν• λ°°ν¬ |

### Docker μΈν”„λΌ
| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `docker-compose up -d` | λ¨λ“  μΈν”„λΌ μ„λΉ„μ¤ μ‹μ‘ |
| `docker-compose down` | λ¨λ“  μΈν”„λΌ μ„λΉ„μ¤ μ¤‘μ§€ |
| `docker-compose --profile dev up -d` | κ°λ° λ„κµ¬ ν¬ν•¨ μ‹¤ν–‰ |

## π“¦ ν¨ν‚¤μ§€ μƒμ„Έ κµ¬μ΅°

### π“ `packages/local-mcp` - λ΅μ»¬ MCP μ„λ²„
```
src/
β”β”€β”€ main.ts                 # NestJS λ¶€νΈμ¤νΈλ©
β”β”€β”€ app.module.ts          # λ£¨νΈ λ¨λ“
β”β”€β”€ mcp/                   # MCP ν”„λ΅ν† μ½ κµ¬ν„
β”‚   β”β”€β”€ mcp.service.ts    # MCP ν•Έλ“¤λ¬
β”‚   β”β”€β”€ mcp.controller.ts # REST μ—”λ“ν¬μΈνΈ
β”‚   β””β”€β”€ mcp.module.ts     # MCP λ¨λ“
β”β”€β”€ grpc/                  # gRPC ν΄λΌμ΄μ–ΈνΈ
β”‚   β”β”€β”€ grpc-client.service.ts
β”‚   β””β”€β”€ grpc-client.module.ts
β””β”€β”€ analysis/              # λ¶„μ„ κΈ°λ¥
    β”β”€β”€ analysis.service.ts
    β””β”€β”€ analysis.controller.ts
```

### π“ `packages/aws-api` - AWS API μ„λ²„
```
src/
β”β”€β”€ index.ts               # Express + gRPC μ„λ²„
β”β”€β”€ grpc/                  # gRPC μ„λ²„ κµ¬ν„
β”‚   β””β”€β”€ grpc.server.ts    # RPC λ©”μ„λ“ κµ¬ν„
β”β”€β”€ routes/                # REST API λΌμ°νΈ
β”‚   β”β”€β”€ health.ts         # ν—¬μ¤μ²΄ν¬
β”‚   β””β”€β”€ analysis.ts       # λ¶„μ„ API
β””β”€β”€ services/              # λΉ„μ¦λ‹μ¤ λ΅μ§
    β””β”€β”€ ai.service.ts     # AI ν†µν•©
```

### π“ `packages/shared` - κ³µμ  μ½”λ“
```
src/
β”β”€β”€ types/                 # TypeScript νƒ€μ… μ •μ
β”‚   β”β”€β”€ git.ts            # Git κ΄€λ ¨ νƒ€μ…
β”‚   β”β”€β”€ analysis.ts       # λ¶„μ„ νƒ€μ…
β”‚   β”β”€β”€ mcp.ts            # MCP ν”„λ΅ν† μ½ νƒ€μ…
β”‚   β”β”€β”€ config.ts         # μ„¤μ • νƒ€μ…
β”‚   β””β”€β”€ errors.ts         # μ—λ¬ ν΄λμ¤
β”β”€β”€ utils/                 # μ ν‹Έλ¦¬ν‹° ν•¨μ
β”‚   β””β”€β”€ index.ts          # κ³µν†µ ν—¬νΌ
β””β”€β”€ proto/                 # Protocol Buffers
    β””β”€β”€ analysis.proto    # gRPC μ„λΉ„μ¤ μ •μ
```

## β™οΈ ν™κ²½ μ„¤μ •

### ν•„μ ν™κ²½ λ³€μ
| λ³€μλ… | μ„¤λ… | κΈ°λ³Έκ°’ |
|--------|------|--------|
| `OPENAI_API_KEY` | OpenAI API ν‚¤ | - |
| `GRPC_SERVER_URL` | gRPC μ„λ²„ μ£Όμ† | `localhost:50051` |
| `PORT` | HTTP μ„λ²„ ν¬νΈ | local: 3001, aws: 3000 |
| `GRPC_PORT` | gRPC μ„λ²„ ν¬νΈ | 50051 |

### Docker μΈν”„λΌ μ„λΉ„μ¤
| μ„λΉ„μ¤ | μ©λ„ | ν¬νΈ |
|--------|------|------|
| **ChromaDB** | λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤ (μ„λ² λ”©) | 8000 |
| **Redis** | μΊμ‹± λ μ΄μ–΄ | 6379 |
| **PostgreSQL** | λ©”νƒ€λ°μ΄ν„° μ €μ¥μ† | 5432 |
| **MinIO** | S3 νΈν™ κ°μ²΄ μ €μ¥μ† | 9000 (API), 9001 (Console) |
| **Nginx** | λ¦¬λ²„μ¤ ν”„λ΅μ‹ | 80, 443 |
| **pgAdmin** | PostgreSQL κ΄€λ¦¬ UI (dev ν”„λ΅νμΌ) | 5050 |
| **Redis Commander** | Redis κ΄€λ¦¬ UI (dev ν”„λ΅νμΌ) | 8081 |

## π”§ κ°λ° κ°€μ΄λ“

### μƒλ΅μ΄ MCP λ„κµ¬ μ¶”κ°€ μ μ°¨
1. **ν”„λ΅ν† μ½ μ •μ**: `packages/shared/proto/analysis.proto`μ— gRPC μ„λΉ„μ¤ μ •μ
2. **μ„λ²„ κµ¬ν„**: `packages/aws-api/src/grpc/grpc.server.ts`μ— ν•Έλ“¤λ¬ κµ¬ν„
3. **ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€**: `packages/local-mcp/src/grpc/grpc-client.service.ts`μ— λ©”μ„λ“ μ¶”κ°€
4. **MCP λ“±λ΅**: `packages/local-mcp/src/mcp/mcp.service.ts`μ— λ„κµ¬ λ“±λ΅

### ν†µμ‹  ν¨ν„΄
| ν¨ν„΄ | λ©”μ„λ“ | μ„¤λ… |
|------|--------|------|
| **Unary RPC** | `learnCodebase` | λ‹¨μ μ”μ²­/μ‘λ‹µ |
| **Server Streaming** | `analyzeCodebase` | λ¶„μ„ μ§„ν–‰ μƒν™© μ¤νΈλ¦¬λ° |
| | `searchCode` | κ²€μƒ‰ κ²°κ³Ό μ¤νΈλ¦¬λ° |
| | `analyzeDiff` | Diff λ¶„μ„ κ²°κ³Ό μ¤νΈλ¦¬λ° |
| **Bidirectional Streaming** | `chatWithCode` | λ€ν™”ν• μ±„ν… |

### λ¨λ²” μ‚¬λ΅€

#### μ„±λ¥ μµμ ν™”
- λ€μ©λ‰ λ°μ΄ν„°λ‚ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈλ” μ¤νΈλ¦¬λ° μ‚¬μ©
- μΊμ‹± μ „λµ μ κ·Ή ν™μ©
- λ°°μΉ μ²λ¦¬λ΅ λ„¤νΈμ›ν¬ νΈμ¶ μµμ†ν™”

#### μ½”λ“ ν’μ§
- gRPC μ¤νΈλ¦Όμ—μ„ μ μ ν• μ—λ¬ μ²λ¦¬ κµ¬ν„
- NestJS λ¨λ“ κµ¬μ΅°μ™€ μμ΅΄μ„± μ£Όμ… ν¨ν„΄ μ¤€μ
- Protocol Buffersμ™€ Zod μ¤ν‚¤λ§λ΅ νƒ€μ… μ•μ „μ„± λ³΄μ¥

#### μ΄μ κ΄€λ¦¬
- ν¨ν‚¤μ§€λ³„ μ‘μ—…μ‹ npm workspaces λ…λ Ήμ–΄ μ‚¬μ©
- ν™κ²½λ³„ μ„¤μ • λ¶„λ¦¬ (development, production, test)
- λ΅κΉ… λ λ²¨ μ μ ν μ„¤μ •

### λ””λ²„κΉ… ν
| λ¬Έμ  μƒν™© | ν•΄κ²° λ°©λ²• |
|-----------|-----------|
| gRPC μ—°κ²° μ‹¤ν¨ | `GRPC_SERVER_URL` ν™κ²½ λ³€μ ν™•μΈ |
| νƒ€μ… μ—λ¬ | `npm run build -w @code-ai/shared` λ¨Όμ € μ‹¤ν–‰ |
| Docker μ„λΉ„μ¤ λ¬Έμ  | `docker-compose logs [μ„λΉ„μ¤λ…]` ν™•μΈ |
| ν…μ¤νΈ μ‹¤ν¨ | `npm test -w [ν¨ν‚¤μ§€λ…]`μΌλ΅ κ°λ³„ ν…μ¤νΈ |

## π“ μ‘μ—… νλ¦„

### κΈ°λ¥ κ°λ° ν”„λ΅μ„Έμ¤
1. νƒ€μ… μ •μ (`packages/shared/src/types/`)
2. Proto νμΌ μ—…λ°μ΄νΈ (ν•„μ”μ‹)
3. μ„λ²„ λ΅μ§ κµ¬ν„
4. ν΄λΌμ΄μ–ΈνΈ ν†µν•©
5. ν…μ¤νΈ μ‘μ„±
6. λ¬Έμ„ μ—…λ°μ΄νΈ

### μ»¤λ°‹ κ·μΉ™
- `feat:` μƒλ΅μ΄ κΈ°λ¥
- `fix:` λ²„κ·Έ μμ •
- `refactor:` μ½”λ“ λ¦¬ν©ν† λ§
- `docs:` λ¬Έμ„ μ—…λ°μ΄νΈ
- `test:` ν…μ¤νΈ μ¶”κ°€/μμ •
- `chore:` λΉλ“/μ„¤μ • λ³€κ²½

## π” μ£Όμ” νμΌ μ„μΉ
```
ν”„λ΅μ νΈ λ£¨νΈ/
β”β”€β”€ packages/
β”‚   β”β”€β”€ local-mcp/        # λ΅μ»¬ MCP μ„λ²„
β”‚   β”β”€β”€ aws-api/          # AWS API μ„λ²„
β”‚   β””β”€β”€ shared/           # κ³µμ  μ½”λ“
β”β”€β”€ docker/               # Docker μ„¤μ •
β”β”€β”€ .env.example         # ν™κ²½ λ³€μ ν…ν”λ¦Ώ
β””β”€β”€ docker-compose.yml   # Docker Compose μ„¤μ •
```